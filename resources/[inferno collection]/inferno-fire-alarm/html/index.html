<!--
Inferno Collection Fire Alarm Version 4.6 ALPHA

Copyright (c) 2019, Christopher M, Inferno Collection. All rights reserved.

This project is licensed under the following:
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to use, copy, modify, and merge the software, under the following conditions:
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. THE SOFTWARE MAY NOT BE SOLD.
-->

<!DOCTYPE html>
<html>
	<head>
		<!-- Required file for FiveM -->
		<script src="nui://game/ui/jquery.js"></script>
		<!-- Panel CSS -->
		<style>
			@font-face {
				font-family: "BPdots-Bold";
				src: url("BPdotsBold.eot?") format("eot"), url("BPdotsBold.woff") format("woff"), url("BPdotsBold.ttf") format("truetype"), url("BPdotsBold.svg#BPdots-Bold") format("svg"); font-weight: normal; font-style: normal;
			}

			html {
				display: none;
				font-family: "BPdots-Bold";
			}

			body {
				overflow: hidden;
			}

			table {
				width: 816px;
				height: 328px;
				position: fixed;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				background-image: url("imgs/sysnormal.png");
				visibility: hidden;
				z-index: -1;
			}

			td {
				height: 30px;
				font-weight: bold;
			}

			button {
				width: 100%;
				opacity: 0.0;
				position: relative;
				visibility: visible;
			}

			button:focus {
				outline: none;
			}

			.power-led {
				height: 44%;
				width: 14%;
				right: -354.5%;
				bottom: 208%;
				position: relative;
				background-color: #00FF00;
				border-radius: 50%;
				box-shadow: rgba(0, 0, 0, 0.2) 0 -1px 7px 1px, inset #441313 0 -1px 9px, rgba(0, 255, 0, 0.5) 0 2px 12px;
				visibility: visible;
			}

			.fire-led {
				height: 44%;
				width: 15%;
				right: -135.5%;
				bottom: -23%;
				position: relative;
				background-color: #F00;
				border-radius: 50%;
				box-shadow: rgba(0, 0, 0, 0.2) 0 -1px 7px 1px, inset #441313 0 -1px 9px, rgba(255, 0, 0, 0.5) 0 2px 12px;
				animation: flashRed 1s infinite;
				visibility: hidden;
			}

			@keyframes flashRed {
				from {
					background-color: #F00;
				}

				50% {
					background-color: #A00;
					box-shadow: rgba(0, 0, 0, 0.2) 0 -1px 15px 1px, inset #441313 0 -1px 9px, rgba(255, 0, 0, 0.5) 0 0 0;
				}

				to {
					background-color: #F00;
				}
			}
		</style>
	</head>

	<body>
		<table id="panel">
			<tbody>
				<tr>
					<td><button id="location" style="
						width: 295%;
						height: 74%;
						right: -275%;
						bottom: -77%;
						background: none;
						border: none;
						font-size: 18px;
						font-family: BPdots-Bold;
						font-weight: normal;
						font-style: normal;
						opacity: 1.0;
						margin-left: -248px;
						margin-top: 5px;
						text-align: left;
					"></button></td>
				</tr>
				<tr>
					<td><button id="1" onclick="ButtonClick(this.id)" style="
						width: 24%;
						height: 101%;
						right: -392%;
						bottom: 34%;
						border-radius: 39%;
					">1</button></td>
					<td><button id="2" onclick="ButtonClick(this.id)" style="
						width: 25%;
						height: 101%;
						right: -344.5%;
						bottom: 34%;
						border-radius: 39%;
					">2</button></td>
					<td><button id="3" onclick="ButtonClick(this.id)" style="
						width: 28%;
						height: 106%;
						right: -313%;
						bottom: 34%;
						border-radius: 39%;
					">3</button></td>
					<td><button id="passcode" style="
						width: 46%;
						height: 76%;
						right: 197%;
						bottom: -25%;
						background: none;
						border: none;
						font-size: 18px;
						font-family: BPdots-Bold;
						font-weight: normal;
						font-style: normal;
						opacity: 1.0;
						margin-left: -1px;
						text-align: left;
					"></button></td>
					<td><button id="message" style="
						width: 296%;
						height: 74%;
						right: 388%;
						bottom: -35%;
						background: none;
						border: none;
						font-size: 18px;
						font-family: BPdots-Bold;
						font-weight: normal;
						font-style: normal;
						opacity: 1.0;
						margin-left: -140px;
					"></button></td>
					<td><button id="access" style="
						width: 28%;
						height: 76%;
						right: 167%;
						bottom: -30%;
						background: none;
						border: none;
						font-size: 18px;
						font-family: BPdots-Bold;
						font-weight: normal;
						font-style: normal;
						opacity: 1.0;
					"></button></td>
				</tr>
				<tr>
					<td><button id="4" onclick="ButtonClick(this.id)" style="
						width: 24%;
						height: 105%;
						right: -392%;
						bottom: 6%;
						border-radius: 39%;
					">4</button></td>
					<td><button id="5" onclick="ButtonClick(this.id)" style="
						width: 26%;
						height: 105%;
						right: -344%;
						bottom: 6%;
						border-radius: 39%;
					">5</button></td>
					<td><button id="6" onclick="ButtonClick(this.id)" style="
						width: 28%;
						height: 105%;
						right: -313%;
						bottom: 6%;
						border-radius: 39%;
					">6</button></td>
				</tr>
				<tr>
					<td>
						<div id="fire-led" class="fire-led"></div>
					</td>
					<td><button id="7" onclick="ButtonClick(this.id)" style="
						width: 26%;
						height: 106%;
						right: -310%;
						bottom: -14%;
						border-radius: 39%;
					">7</button></td>
					<td><button id="8" onclick="ButtonClick(this.id)" style="
						width: 29%;
						height: 106%;
						right: -274%;
						bottom: -14%;
						border-radius: 39%;
					">8</button></td>
					<td><button id="9" onclick="ButtonClick(this.id)" style="
						width: 29%;
						height: 106%;
						right: -218%;
						bottom: -14%;
						border-radius: 39%;
					">9</button></td>
				</tr>
				<tr>
					<td><button id="ack" onclick="ButtonClick(this.id)" style="
						width: 29%;
						height: 158%;
						right: -128.5%;
						bottom: -10%;
						border-radius: 39%;
					">ACK1</button></td>
					<td><button id="" onclick="ButtonClick(this.id)" style="
						width: 31%;
						height: 158%;
						right: -71%;
						bottom: -10%;
						border-radius: 39%;
					">ACK2</button></td>
					<td><button id="sil" onclick="ButtonClick(this.id)" style="
						width: 37%;
						height: 158%;
						right: -128%;
						bottom: -14%;
						border-radius: 39%;
					">SIL</button></td>
					<td><button id="res" onclick="ButtonClick(this.id)" style="
						width: 37%;
						height: 158%;
						right: -80%;
						bottom: -12%;
						border-radius: 39%;
					">RES</button></td>
					<td><button id="0" onclick="ButtonClick(this.id)" style="
						width: 55%;
						height: 106%;
						right: -134%;
						bottom: -34%;
						border-radius: 39%;
					">0</button></td>
					<td><button id="del" onclick="ButtonClick(this.id)" style="
						width: 30%;
						height: 106%;
						right: -59%;
						bottom: -34%;
						border-radius: 39%;
					">DEL</button></td>
				</tr>
				<tr>
					<td>
						<div class="power-led"></div>
					</td>
				</tr>
				<tr>
					<td><button id="prev" onclick="ButtonClick(this.id)" style="
						width: 29%;
						height: 122%;
						right: -331%;
						bottom: -12%;
						position: relative;
						visibility: visible;
						border-top-left-radius: 55%;
						border-top-right-radius: 55%;
					">PREV</button></td>
					<td><button id="next" onclick="ButtonClick(this.id)" style="
						width: 31%;
						height: 128%;
						right: -245%;
						bottom: -141%;
						border-bottom-left-radius: 55%;
						border-bottom-right-radius: 55%;
					">NEXT</button></td>
					<td><button id="exit" onclick="ButtonClick(this.id)" style="
						width: 28%;
						height: 113%;
						right: -312.5%;
						bottom: 55%;
						border-radius: 39%;
					">EXIT</button></td>
					<td><button id="ent" onclick="ButtonClick(this.id)" style="
						width: 29%;
						height: 113%;
						right: -178%;
						bottom: 55%;
						border-radius: 39%;
					">ENT</button></td>
				</tr>
				<tr>
					<td><button id="menu" onclick="ButtonClick(this.id)" style="
						width: 21%;
						height: 125%;
						right: -302.5%;
						bottom: 45%;
						border-radius: 39%;
					">MENU</button></td>
				</tr>
				<tr></tr>
				<tr></tr>
			</tbody>
		</table>

		<script>
			$(function () {
				FireAlarms = [];
				SounderAlarms = [];
				Announcements = [];
				Beeps = [];
				Text = false;
				
				// Wait to receive a message 
				window.addEventListener("message", function (event) {
					if (event.data.PayloadType == "PlayAlarm") {
						if (!FireAlarms[event.data.Payload]) {
							FireAlarms[event.data.Payload] = new Audio("./sounds/alarm.mp3");
							// Set volume 0, assuming it will be updated in the next few frames
							FireAlarms[event.data.Payload].volume = 0.0;
							FireAlarms[event.data.Payload].loop = true;
							FireAlarms[event.data.Payload].play();
						}

					} if (event.data.PayloadType == "WalkAround") {
						if (!FireAlarms[event.data.Control]) {
							PlayAudio(FireAlarms, event.data.Payload.Control, "testing_channel", false);
							FireAlarms[event.data.Payload.Control].addEventListener("ended", function(){
								setTimeout(function(){
									PlayAudio(FireAlarms, event.data.Payload.Control, event.data.Payload.Channel, false);
									FireAlarms[event.data.Payload.Control].addEventListener("ended", function(){
										setTimeout(function(){
											PlayAudio(FireAlarms, event.data.Payload.Control, "device", false);
											FireAlarms[event.data.Payload.Control].addEventListener("ended", function(){
												setTimeout(function(){
													// Turns the ID into individual integers
													var Digits = event.data.Payload.ID.toString().split("");
													var RealDigits = Digits.map(Number).reverse();
													var TempWrap = []

													for (var i = 0; i < RealDigits.length; i++) {
														let Sound = i
														let Length = RealDigits.length - i
														setTimeout(function(){
															PlayAudio(FireAlarms, event.data.Payload.Control, RealDigits[Sound], false);
														// For every integer, wait an extra second
														}, 1000 * (Length - 1));
													};

													setTimeout(function(){
														PlayAudio(FireAlarms, event.data.Payload.Control, "testing_channel", false);
														FireAlarms[event.data.Payload.Control].addEventListener("ended", function(){
															setTimeout(function(){
																PlayAudio(FireAlarms, event.data.Payload.Control, event.data.Payload.Channel, false);
																FireAlarms[event.data.Payload.Control].addEventListener("ended", function(){
																	setTimeout(function(){
																		PlayAudio(FireAlarms, event.data.Payload.Control, "device", false);
																		FireAlarms[event.data.Payload.Control].addEventListener("ended", function(){
																			setTimeout(function(){

																				for (var i = 0; i < RealDigits.length; i++) {
																					let Sound = i
																					let Length = RealDigits.length - i
																					setTimeout(function(){
																						PlayAudio(FireAlarms, event.data.Payload.Control, RealDigits[Sound], false);
																					// For every integer, wait an extra second
																					}, 1000 * (Length - 1));
																				};

																				setTimeout(function(){
																					// Send call back
																					$.post("http://inferno-fire-alarm/RemoveWalkTest", JSON.stringify(event.data.Payload.Control));
																					FireAlarms[event.data.Payload.Control] = null;
																				// For every integer, wait an extra second
																				},  1000 * (RealDigits.length + 1));
																			}, 700);
																		});
																	}, 200);
																});
															}, 500);
														});
													// For every integer, wait an extra second
													}, 1000 * (RealDigits.length + 1));
												}, 700);
											});
										}, 200);
									});
								}, 500);
							});
						}

					} else if (event.data.PayloadType == "SetAlarmVolume") {
						if (FireAlarms[event.data.Payload[0]]) FireAlarms[event.data.Payload[0]].volume = event.data.Payload[1];

					} else if (event.data.PayloadType == "StopAlarm") {
						if (FireAlarms[event.data.Payload]) {
							FireAlarms[event.data.Payload].loop = false;
							FireAlarms[event.data.Payload].addEventListener("ended", function(){
								FireAlarms[event.data.Payload] = null;
							});
						}

						if (SounderAlarms[event.data.Payload]) {
							SounderAlarms[event.data.Payload].loop = false;
							SounderAlarms[event.data.Payload].addEventListener("ended", function(){
								SounderAlarms[event.data.Payload] = null;
							});
						}

					} else if (event.data.PayloadType == "PlaySounder") {
						if (!SounderAlarms[event.data.Payload]) {
							SounderAlarms[event.data.Payload] = new Audio("./sounds/panelsounder.mp3");
							// Set volume 0, assuming it will be updated in the next few frames
							SounderAlarms[event.data.Payload].volume = 0.0;
							SounderAlarms[event.data.Payload].loop = true;
							SounderAlarms[event.data.Payload].play();
						}

					} else if (event.data.PayloadType == "SetSounderVolume") {
						if (SounderAlarms[event.data.Payload[0]]) SounderAlarms[event.data.Payload[0]].volume = event.data.Payload[1];
					
					} else if (event.data.PayloadType == "PlayAnn") {
						if (!Announcements[event.data.Payload[0]]) {
							Announcements[event.data.Payload[0]] = new Audio("./sounds/test" + event.data.Payload[1] + ".mp3");
							// Set volume 0, assuming it will be updated in the next few frames
							Announcements[event.data.Payload[0]].volume = 0.0;
							Announcements[event.data.Payload[0]].play();
							Announcements[event.data.Payload[0]].addEventListener("ended", function(){
								// Send call back
								$.post("http://inferno-fire-alarm/RemoveAnn", JSON.stringify(event.data.Payload[0]));
								Announcements[event.data.Payload[0]] = null;
							});
						}

					} else if (event.data.PayloadType == "PlayClear") {
						if (!Announcements[event.data.Payload[0]]) {
							Announcements[event.data.Payload[0]] = new Audio("./sounds/clear.mp3");
							// Set volume 0, assuming it will be updated in the next few frames
							Announcements[event.data.Payload[0]].volume = 0.0;
							Announcements[event.data.Payload[0]].play();
							Announcements[event.data.Payload[0]].addEventListener("ended", function(){
								// Send call back
								$.post("http://inferno-fire-alarm/RemoveAnn", JSON.stringify(event.data.Payload[0]));
								Announcements[event.data.Payload[0]] = null;
							});
						}

					} else if (event.data.PayloadType == "SetAnnVolume") {
						if (Announcements[event.data.Payload[0]]) Announcements[event.data.Payload[0]].volume = event.data.Payload[1];

					} else if (event.data.PayloadType == "OpenPanel") {
						// Make panel visible
						document.documentElement.style.display = "block";
						var x = document.getElementById("panel");
						x.setAttribute("style", "background-image: url(imgs/" + event.data.Payload[0] + ".png); visibility: visible;");
						document.body.appendChild(x);
						// If panel requires fire led active
						if (event.data.Payload[0] == "ack" || event.data.Payload[0] == "fire" || event.data.Payload[0] == "gack" || event.data.Payload[0] == "sil") {
							$("#fire-led").css({ "visibility": "visible" });
						} else {
							$("#fire-led").css({ "visibility": "hidden" });
						}

						// If text is already on the screen
						if (Text) {
							$("#" + Text[1][0]).text("");
							Text = false;
						}

						// Update on-screen text if needed
						if (event.data.Payload[1][0]) {
							Text = event.data.Payload;
							$("#" + event.data.Payload[1][0]).text(event.data.Payload[1][1]);
						}

					} else if (event.data.PayloadType == "ClosePanel") {
						// Make panel invisible
						document.documentElement.style.display = "none";
						var x = document.getElementById("panel");
						x.setAttribute("style", "visibility: hidden;");
						document.body.appendChild(x);
						$("#fire-led").css({ "visibility": "hidden" });

					} else if (event.data.PayloadType == "SetAccessLevel") {
						$("#access").text(event.data.Payload);
						Text = [[null], ["access", event.data.Payload]];
					}
				});

				// When client presses any button on their keyboard
				document.onkeyup = function (data) {
					// If client presses Escape key
					if (data.which == 27) {
						// Send callback to close panel
						$.post("http://inferno-fire-alarm/ClosePanel");
					}
				};
			});

			// Plays requested Audio
			function PlayAudio(Wrapper, ID, Sound, Loop) {
				Wrapper[ID] = new Audio("./sounds/" + Sound +".mp3");
				Wrapper[ID].volume = 0.0;
				Wrapper[ID].loop = Loop
				Wrapper[ID].play();
			}

			// When client clicks on a panel button
			function ButtonClick(ID) {
				var Rand = Math.random();
				Beeps[Rand] = new Audio("./sounds/beep.mp3");
				Beeps[Rand].volume = 0.5;
				Beeps[Rand].play();
				Beeps[Rand].addEventListener("ended", function() { Beeps[Rand] = null });
				$.post("http://inferno-fire-alarm/Button", JSON.stringify(ID));
			}
		</script>
	</body>
</html>